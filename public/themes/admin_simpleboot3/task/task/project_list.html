<!doctype html>
<html class="no-js">
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    <title>项目列表 - </title>
    <!-- Set render engine for 360 browser -->
    <meta name="renderer" content="webkit">
    <!-- No Baidu Siteapp-->
    <meta http-equiv="Cache-Control" content="no-siteapp"/>
    <!-- Tile icon for Win8 (144x144 + tile color) -->

    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/amazeui.min.css?v=2.3.3">
    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/admin.css?v=2.3.3">
    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/app.css?v=2.3.3">
    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/ui-dialog.css?v=2.3.3">
    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/amazeui.datetimepicker.css?v=2.3.3">

    <script>
        var PESCMS_URL = 'https://www.pescms.com';
        var PESCMS_PATH = '';
    </script>

    <!--[if (gte IE 9)|!(IE)]><!-->
    <script src="__STATIC__/Theme/assets/js/jquery.min.js?v=2.3.3"></script>
    <!--<![endif]-->
    <!--[if lte IE 8 ]>
    <script src="__STATIC__/Theme/assets/js/jquery.min.js?v=2.3.3"></script>
    <script src="__STATIC__/Theme/assets/js/modernizr.js?v=2.3.3"></script>
    <script src="__STATIC__/Theme/assets/js/amazeui.ie8polyfill.min.js?v=2.3.3"></script>
    <![endif]-->
    <script src="__STATIC__/Theme/assets/js/amazeui.min.js?v=2.3.3"></script>
    <script src="__STATIC__/Theme/assets/js/dialog-min.js?v=2.3.3"></script>
    <script src="__STATIC__/Theme/assets/js/dialog-plus-min.js?v=2.3.3"></script>
    <script src="__STATIC__/Theme/assets/js/amazeui.datetimepicker.min.js?v=2.3.3"></script>

    <!--加载百度编辑器-->
    <script src="__STATIC__/Theme/assets/ueditor/ueditor.config.js?v=2.3.3"></script>
    <script src="__STATIC__/Theme/assets/ueditor/ueditor.all.js?v=2.3.3"></script>
    <script src="__STATIC__/Theme/assets/ueditor/lang/zh-cn/zh-cn.js?v=2.3.3"></script>
    <!--加载百度编辑器-->

    <!--百度上传控件-->
    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/webuploader.css"/>
    <script src="__STATIC__/Theme/assets/js/webuploader.js"></script>
    <script src="__STATIC__/Theme/assets/js/AMUIwebuploader.js"></script>
    <script>
        $(function(){
            $.webuploaderConfig({
                server:'/?g=Team&m=Upload&a=ueditor&method=POST&action=uploadimage'
            });
        })
    </script>
    <!--百度上传控件-->

    <!--拾色器-->
    <script src="__STATIC__/Theme/assets/js/spectrum.js?v=2.3.3"></script>
    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/spectrum.css?v=2.3.3"/>
    <!--拾色器-->

    <!--图片放大器-->
    <script src="__STATIC__/Theme/assets/js/jquery.fancybox.min.js?v=2.3.3"></script>
    <link rel="stylesheet" href="__STATIC__/Theme/assets/css/jquery.fancybox.min.css?v=2.3.3"/>
    <!--图片放大器-->

    <script src="__STATIC__/Theme/assets/js/app.js?v=2.3.3"></script>
</head>
<body><div class="am-text-sm am-padding-top" id="container">
    <!-- content start -->
    <div class=" am-padding-xs am-padding-top-0">
        <div class="am-panel am-panel-default">
            <div class="am-panel-bd">
                <div class="am-cf">
                    <div class="am-fl am-cf">
                        <strong class="am-text-primary am-text-lg"><a href="{:url('task/task/projectList')}">项目列表</a>
                        </strong> /
                        <small>列表</small>
                    </div>
                </div>

                <div class="am-g am-margin-bottom-xs am-g-collapse">
                    <div class="am-u-sm-12 am-u-md-6 am-padding-top-xs">
                        <div class="am-btn-toolbar">
                            <div class="am-btn-group am-btn-group-xs">
                                <a href="{:url('task/task/addProject')}" class="am-btn am-radius am-btn-default"><span class="am-icon-plus"></span> 新增</a>
                            </div>
                        </div>
                    </div>


                    <div class="am-u-sm-12 am-u-md-3">
                        <form>
                            <div class="am-input-group am-input-group-sm">
                                <input type="text" name="keyword" value="" class="am-form-field">
                                <span class="am-input-group-btn">
                        <input class="am-btn am-radius am-btn-default" type="submit" value="搜索"/>
                    </span>
                            </div>
                        </form>
                    </div>
                </div>
                <hr data-am-widget="divider" style="" class="am-divider am-divider-dashed" />

                <form class="am-form ajax-submit" action="/?g=Team&m=Project&a=listsort" method="POST">
                    <input type="hidden" name="method" value="PUT"/>
                    <table class="am-table am-table-bordered am-table-striped am-table-hover am-text-sm">
                        <tr>
                            <th class="table-sort">排序</th>
                            <th class="table-set">ID</th>
                            <th class="table-title">项目名称</th>
                            <th class="table-set">操作</th>
                        </tr>
                        <foreach name="list" item="vo">
                        <tr>
                            <td class="am-text-middle">
                                <input type="text" class="am-input-sm" name="id[{$vo.project_id}]"
                                       value="{$vo.project_listsort}">
                            </td>
                            <td class="am-text-middle">{$vo.project_id}</td>
                            <td class="am-text-middle">
                                {$vo.project_title}
                            </td>


                            <td class="am-text-middle">
                                <a class="am-text-secondary" href="{:url('task/task/editProject',['project_id'=>$vo.project_id])}"><span class="am-icon-pencil-square-o"></span> 编辑</a>
                                <i class="am-margin-left-xs am-margin-right-xs">|</i>
                                <a class="am-text-danger ajax-click ajax-dialog"  msg="确定删除吗？将无法恢复的！" href="{:url('task/task/delProject',['project_id'=>$vo.project_id])}?back_url=Lz9nPVRlYW0mbT1Qcm9qZWN0JmE9aW5kZXg="><span class="am-icon-trash-o"></span> 删除</a>                            </td>
                        </tr>
                        </foreach>
                    </table>
                    <ul class="am-pagination am-pagination-right am-text-sm">
                        <li><a>总计<b>{$list->total()}</b>个记录</a></li>{$list->render()}               </ul>
                   <!-- <div class="am-margin-top">
                        <button type="submit" class="am-btn am-radius am-btn-primary am-btn-xs">排序</button>
                    </div>-->
                </form>

                <script>
                    $(function(){
                        $('.am-btn-group>a.am-btn-default').after('<a href="javascript:void(0)" class="am-btn am-btn-success"><span class="am-icon-bar-chart"></span> 项目数据分析</a>')
                    })
                </script>

            </div>
        </div>
    </div>
    <!-- content end --></div>
<!--请勿删除页脚这部分代码，否则会导致程序异常-->
<footer class="my-footer pescms-footer-2">
    <small>© Copyright 2015-2022. Power by <a href="javascript:void(0)" target="">Dgg</a>
    </small>
</footer>
<!--请勿删除页脚这部分代码，否则会导致程序异常-->
<div id="bulletin" class="am-offcanvas" >
    <div class="am-offcanvas-bar am-padding-0">
        <div class="am-offcanvas-content bulletin-content am-padding-0">
        </div>
    </div>
</div>
<script>
    $(function(){
        var version  = '2.3.3';
        var timestamp = Date.parse( new Date());

        //获取本地存储
        var important = parseInt(localStorage.getItem('important'));
        var close_important = parseInt(localStorage.getItem('close_important'));
        var record_version = localStorage.getItem('version');
        var check_time = localStorage.getItem('check_time');

        //检查是否需要弹窗重要更新提示框
        if(important == 1 && close_important != 1 && record_version == version ){
            var alter_str = '<div class="am-alert am-alert-warning am-margin-0 am-text-sm" data-am-alert><button type="button" class="am-close close-important">&times;</button>' +
                '当前系统有一个重要更新发布，点击 <a href="/?g=Team&m=Setting&a=upgrade" style="color:blue">这里</a> 查看' +
                '</div>';
            $('header').before(alter_str);
        }

        /**
         * 判断本地存储的版本号与程序版本号是否一致
         * 判断上次检查更新时间记录是否大于1天
         */
        if(record_version != version && check_time<= timestamp){
            $.getJSON(PESCMS_URL+'/patch/2/2.3.3', function(data){
                if(data.status == 200){
                    if(data.data.important == 1){
                        localStorage.setItem('important', '1')
                    }
                    localStorage.setItem('version', version);
                    localStorage.removeItem('close_important')
                }
            }).complete(function(){
                localStorage.setItem('check_time', timestamp + 86400000);
            })
        }

        $('body').on('click', '.close-important', function(){
            localStorage.setItem('close_important', '1')
        })

    })
</script>
</body>
</html>
